# μΏΌλ¦¬ λ©”μ‹μ§€μ™€ μ¤νΈλ¦¬λ° μ μ–΄μ ν•„μ”μ„± λ¶„μ„

## π“‹ κ°μ”

OpenIGTLink Protocol v3.0μ—μ„ μ •μλ μΏΌλ¦¬ λ° μ¤νΈλ¦¬λ° μ μ–΄ λ©”μ‹μ§€μ ν•„μ”μ„±κ³Ό κµ¬ν„ μ°μ„ μμ„λ¥Ό λ¶„μ„ν•©λ‹λ‹¤.

## π” λ©”μ‹μ§€ νƒ€μ… μ„¤λ…

### 1. GET_* (μΏΌλ¦¬ λ©”μ‹μ§€)

**λ©μ **: λ‹¨μΌ λ°μ΄ν„°λ¥Ό μ”μ²­

**λ™μ‘ λ°©μ‹**:
- ν΄λΌμ΄μ–ΈνΈ β†’ μ„λ²„: `GET_<datatype>` μ „μ†΅
- μ„λ²„ β†’ ν΄λΌμ΄μ–ΈνΈ: `<datatype>` λ©”μ‹μ§€λ΅ μ‘λ‹µ
- λ°μ΄ν„° μ—†μ„ μ‹: body size = 0μΈ λ©”μ‹μ§€ λ°ν™

**μμ‹**:
```
Client: GET_TRANSFORM (device: "Tracker")
Server: TRANSFORM (device: "Tracker", matrix: [...])
```

### 2. STT_* / STP_* (μ¤νΈλ¦¬λ° μ μ–΄)

**λ©μ **: μ—°μ† λ°μ΄ν„° μ¤νΈλ¦Ό μ‹μ‘/μ¤‘μ§€

**λ™μ‘ λ°©μ‹**:
- ν΄λΌμ΄μ–ΈνΈ β†’ μ„λ²„: `STT_<datatype>` (μ¤νΈλ¦Ό μ‹μ‘)
- μ„λ²„ β†’ ν΄λΌμ΄μ–ΈνΈ: `RTS_<datatype>` (μμ‹  ν™•μΈ)
- μ„λ²„ β†’ ν΄λΌμ΄μ–ΈνΈ: μ—°μ†μ μΈ `<datatype>` λ©”μ‹μ§€
- ν΄λΌμ΄μ–ΈνΈ β†’ μ„λ²„: `STP_<datatype>` (μ¤νΈλ¦Ό μ¤‘μ§€)
- μ„λ²„ β†’ ν΄λΌμ΄μ–ΈνΈ: `RTS_<datatype>` (μ¤‘μ§€ ν™•μΈ)

**μμ‹**:
```
Client: STT_TDATA (device: "Tracker")
Server: RTS_TDATA (status: OK)
Server: TDATA, TDATA, TDATA... (60Hz)
Client: STP_TDATA (device: "Tracker")
Server: RTS_TDATA (status: OK)
```

### 3. RTS_* (Ready To Send)

**λ©μ **: μ„λ²„μ μΏΌλ¦¬ μμ‹  ν™•μΈ

**μ‚¬μ© μ‹λ‚λ¦¬μ¤**:
- GET_ μΏΌλ¦¬ μ‘λ‹µ ν™•μΈ
- STT_/STP_ μ μ–΄ μμ‹  ν™•μΈ

## π“ ν”„λ΅ν† μ½λ³„ μ§€μ› ν„ν™©

| λ©”μ‹μ§€ νƒ€μ… | GET | STT/STP/RTS | μ„¤λ… |
|------------|-----|-------------|------|
| IMAGE | β… | β… | μμƒ μ¤νΈλ¦¬λ° |
| TRANSFORM | β… | β… | λ³€ν™ ν–‰λ ¬ |
| POSITION | β… | β… | μ„μΉ/λ°©ν–¥ |
| TDATA | β… | β… | μ¶”μ  λ°μ΄ν„° |
| QTDATA | β | β… | μΏΌν„°λ‹μ–Έ μ¶”μ  |
| NDARRAY | β… | β… | Nμ°¨μ› λ°°μ—΄ |
| IMGMETA | β… | β | μμƒ λ©”νƒ€λ°μ΄ν„° |
| LBMETA | β… | β | λΌλ²¨ λ©”νƒ€λ°μ΄ν„° |
| POINT | β… | β | ν¬μΈνΈ λ°μ΄ν„° |
| TRAJ | β… | β | κ¶¤μ  λ°μ΄ν„° |
| CAPABILITY | β… | β | λ¥λ ¥ μ΅°ν |
| STATUS | β… | β | μƒνƒ μ΅°ν |
| COMMAND | β | RTSλ§ | λ…λ Ή μ‘λ‹µ |
| POLYDATA | β… | β… | ν΄λ¦¬κ³¤ λ°μ΄ν„° |

## π― ν•„μ”μ„± λ¶„μ„

### β… **ν•„μμ μΈ κ²½μ°**

1. **Pull κΈ°λ° μ•„ν‚¤ν…μ²**
   - ν΄λΌμ΄μ–ΈνΈκ°€ ν•„μ”ν•  λ•λ§ λ°μ΄ν„° μ”μ²­
   - μ„λ²„λ” μλ™μ μΌλ΅ λ€κΈ°
   - μ: `GET_STATUS`, `GET_CAPABILITY`

2. **λ€μ—­ν­ μ μ–΄**
   - μ¤νΈλ¦¬λ° on/off μ μ–΄ ν•„μ”
   - κ³ μ£Όν λ°μ΄ν„° (60Hz+ μ¶”μ )
   - μ: `STT_TDATA` β†’ μ¶”μ  μ‹μ‘, `STP_TDATA` β†’ μ¤‘μ§€

3. **λ‹¤μ¤‘ ν΄λΌμ΄μ–ΈνΈ ν™κ²½**
   - κ° ν΄λΌμ΄μ–ΈνΈκ°€ λ…λ¦½μ μΌλ΅ μ¤νΈλ¦Ό μ μ–΄
   - λ¦¬μ†μ¤ μµμ ν™”

### β οΈ **μ„ νƒμ μΈ κ²½μ°**

1. **Push κΈ°λ°μΌλ΅ λ€μ²΄ κ°€λ¥**
   ```rust
   // GET_* λ€μ‹ 
   client.send(TransformMessage::default())?;

   // STT_/STP_ λ€μ‹ 
   loop {
       if should_stream {
           client.send(tracking_data)?;
       }
   }
   ```

2. **μ• ν”λ¦¬μΌ€μ΄μ… λ λ²¨ μ μ–΄**
   - COMMAND λ©”μ‹μ§€λ΅ μ μ–΄ κ°€λ¥
   - STRING λ©”μ‹μ§€λ΅ λ…λ Ή μ „μ†΅

3. **ν„λ€μ  ν¨ν„΄**
   - WebSocket: μμ²΄ μ¤νΈλ¦Ό μ μ–΄
   - gRPC: bidirectional streaming
   - MQTT: pub/sub ν¨ν„΄

## π”„ ν„μ¬ Rust κµ¬ν„μ²΄μ λ€μ•

### GET_* λ€μ•

```rust
// λ°©λ²• 1: μ§μ ‘ μ”μ²­
client.request_transform("Tracker")?;

// λ°©λ²• 2: COMMAND λ©”μ‹μ§€ μ‚¬μ©
client.send(CommandMessage::new("GET", "TRANSFORM"))?;

// λ°©λ²• 3: μ• ν”λ¦¬μΌ€μ΄μ… ν”„λ΅ν† μ½
client.send(StringMessage::new("request:transform:tracker"))?;
```

### STT_/STP_ λ€μ•

```rust
// λ°©λ²• 1: COMMAND λ©”μ‹μ§€
client.send(CommandMessage::new("START_TRACKING", ""))?;
client.send(CommandMessage::new("STOP_TRACKING", ""))?;

// λ°©λ²• 2: ν”λκ·Έ μ μ–΄
let mut streaming = true;
loop {
    if streaming {
        server.send(tracking_data)?;
    }
}

// λ°©λ²• 3: Tokio channel
let (tx, rx) = mpsc::channel(100);
// μ¤νΈλ¦Ό μ μ–΄λ¥Ό channelλ΅
```

## π’΅ κ¶μ¥ μ‚¬ν•­

### μ°μ„ μμ„ 1: ν•„μ μΏΌλ¦¬ λ©”μ‹μ§€

**κµ¬ν„ ν•„μ”**:
- `GET_CAPABILITY` - ν”„λ΅ν† μ½ ν‘μƒμ— ν•„μ
- `GET_STATUS` - μ‹μ¤ν… μƒνƒ ν™•μΈ

**μ΄μ **: ν‘μ¤€ ν”„λ΅ν† μ½ νΈν™μ„±

### μ°μ„ μμ„ 2: μ„ νƒμ  μΏΌλ¦¬

**κµ¬ν„ κ³ λ ¤**:
- `GET_TRANSFORM`, `GET_IMAGE` λ“±
- λ κ±°μ‹ C++ ν΄λΌμ΄μ–ΈνΈ νΈν™μ„± ν•„μ” μ‹

**λ€μ•**: COMMAND λ©”μ‹μ§€λ΅ κµ¬ν„

### μ°μ„ μμ„ 3: μ¤νΈλ¦¬λ° μ μ–΄

**κµ¬ν„ λ¶ν•„μ”** (ν„μ¬):
- ν„λ€μ  λΉ„λ™κΈ° I/Oλ΅ μ¶©λ¶„
- Tokioμ channel/streamμΌλ΅ λ€μ²΄
- μ• ν”λ¦¬μΌ€μ΄μ… λ λ²¨ μ μ–΄ κ°€λ¥

**κµ¬ν„ ν•„μ”** (ν–¥ν›„):
- C++ OpenIGTLink μ„λ²„μ™€ ν†µμ‹  ν•„μ” μ‹
- ν‘μ¤€ μ¤€μκ°€ μ¤‘μ”ν• μλ£κΈ°κΈ° ν™κ²½

## π“ κµ¬ν„ μ‹λ‚λ¦¬μ¤λ³„ ν•„μ”μ„±

| μ‹λ‚λ¦¬μ¤ | GET_ | STT_/STP_ | λΉ„κ³  |
|---------|------|-----------|------|
| **Rust β†” Rust** | β | β | λ¶ν•„μ” |
| **Rust β†” C++** | β… | β… | νΈν™μ„± ν•„μ” |
| **λ‹¨μΌ ν΄λΌμ΄μ–ΈνΈ** | β | β | μ§μ ‘ μ μ–΄ κ°€λ¥ |
| **λ‹¤μ¤‘ ν΄λΌμ΄μ–ΈνΈ** | β οΈ | β… | μ μ–΄ ν•„μ” |
| **μλ£κΈ°κΈ° μΈμ¦** | β… | β… | ν‘μ¤€ μ¤€μ |
| **ν”„λ΅ν† νƒ€μ…** | β | β | λ¶ν•„μ” |

## π¬ κ²°λ΅ 

### ν„μ¬ μƒνƒ
Rust κµ¬ν„μ²΄λ” **ν•µμ‹¬ λ°μ΄ν„° λ©”μ‹μ§€μ— μ§‘μ¤‘**ν•μ—¬ μΏΌλ¦¬/μ¤νΈλ¦¬λ° μ μ–΄ μ—†μ΄λ„ μ¶©λ¶„ν λ™μ‘ κ°€λ¥

### κµ¬ν„μ΄ ν•„μ”ν• κ²½μ°
1. **C++ OpenIGTLinkμ™€ μƒνΈμ΄μ©μ„±** ν•„μ”
2. **μλ£κΈ°κΈ° μΈμ¦**μ„ μ„ν• ν‘μ¤€ μ¤€μ
3. **λ‹¤μ¤‘ ν΄λΌμ΄μ–ΈνΈ** ν™κ²½μ—μ„ λ¦¬μ†μ¤ κ΄€λ¦¬

### κ¶μ¥ μ ‘κ·Ό
- **Phase 1**: GET_CAPABILITY, GET_STATUSλ§ κµ¬ν„ (ν•µμ‹¬)
- **Phase 2**: λ‹¤λ¥Έ GET_* λ©”μ‹μ§€ (ν•„μ”μ‹)
- **Phase 3**: STT_/STP_/RTS_ (C++ νΈν™μ„± ν•„μ”μ‹)

**ν„μ¬λ” κµ¬ν„ν•μ§€ μ•κ³ , ν•„μ”μ„±μ΄ λ…ν™•ν•΄μ§ λ• μ¶”κ°€ν•λ” κ²ƒμ„ κ¶μ¥ν•©λ‹λ‹¤.**
